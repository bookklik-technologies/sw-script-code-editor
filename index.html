<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>GrapesJS Script Editor with CodeMirror Editor</title>
    <link href="https://unpkg.com/grapesjs/dist/css/grapes.min.css" rel="stylesheet">
    <script src="https://unpkg.com/grapesjs"></script>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
      }
    </style>
  </head>
  <body>

    <div id="gjs" style="height:0px; overflow:hidden">
      <div style="margin:100px 100px 25px; padding:25px; font:caption">
        <h2>GrapesJS Script Editor with CodeMirror</h2>
        <p>This plugin uses CodeMirror 6 to provide a powerful code editing experience within GrapesJS.</p>
        <ul>
          <li>Integrated CodeMirror 6 initialization</li>
          <li>VS Code Dark theme support</li>
          <li>JavaScript syntax highlighting</li>
          <li>Configurable CodeMirror options</li>
          <li>JavaScript validation with syntax error highlighting</li>
        </ul>
        <p>Select any component and use the script icon in the toolbar to add JavaScript code!</p>
      </div>
    </div>

    <script type="text/javascript">
      window.onload = () => {
        // GrapesJS initialization
        window.editor = grapesjs.init({
          height: '100%',
          showOffsets: true,
          allowScripts: true,
          noticeOnUnload: false,
          storageManager: false,
          container: '#gjs',
          fromElement: true,

          plugins: ['sw-script-code-editor'],
          pluginsOpts: {
            'sw-script-code-editor': {
              // CodeMirror Editor configuration
              codeMirrorOptions: {
                lineNumbers: true,
                tabSize: 2,
              },
              // Plugin UI configuration
              modalTitle: 'Script Editor',
              buttonLabel: 'Save Script',
              starter: 'let el = this;\n// Add your JavaScript code here',
              // Component types to allow script editing
              scriptTypesSupport: ['default', 'wrapper', 'text', 'textnode', 'image', 'video', 'svg'],
              onRun: () => console.log('Script validation passed'),
              onError: (err) => console.error('Script validation failed:', err)
            }
          }
        });
      };
    </script>
  </body>
</html>